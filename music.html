<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Awesome Music Player</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

  <style>
    :root {
      --spotify-green: #1DB954;
      --spotify-black: #191414;
      --spotify-white: #FFFFFF;
      --spotify-light-gray: #B3B3B3;
      --spotify-dark-gray: #535353;
      --spotify-card-bg: #181818;
      --spotify-hover-bg: #282828;
      --spotify-border-radius: 8px; /* Consistent border radius */
      --spotify-font-family: 'Circular', 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: var(--spotify-font-family);
    }

    body {
      background-color: #121212;
      color: #ffffff;
      display: flex;
      flex-direction: column;
      min-height: 100vh; 
      padding-bottom: 80px;
    }
    .controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 10px;
}

.favorite-btn {
  color: #e74c3c; /* Red color for favorites */
  font-size: 18px;
  transition: all 0.2s ease;
}

.favorite-btn .fas {
  color: #e74c3c; /* Solid red for favorited items */
}

.favorite-btn .far {
  color: var(--spotify-light-gray); /* Gray for non-favorited items */
}

.favorite-btn:hover {
  transform: scale(1.1);
}

  
    .header {
      background-color: #1e1e1e;
      padding: 15px 20px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
      color: var(--spotify-green);
    }

    .menu {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      align-items: center;
    }

    .menu li {
      margin-left: 20px;
      cursor: pointer;
      transition: color 0.3s ease;
      font-size: 16px;
    }

    .menu li:hover, .menu li.active {
      color: var(--spotify-green);
    }
    .hamburger-menu {
      display: none;
      position: fixed;
      top: 15px;
      left: 15px;
      z-index: 1000;
      cursor: pointer;
      font-size: 24px;
      color: white;
    }
    #song-list ol li .favorite-btn {
  background: none;
  border: none;
  padding: 5px;
  margin-left: 10px;
  cursor: pointer;
}

#song-list ol li {
  padding: 10px;
  transition: background-color 0.2s ease;
}

#song-list ol li:hover {
  background-color: var(--spotify-hover-bg);
}

   
    .sidebar {
      width: 250px;
      background-color: #181818;
      padding: 20px;
      position: fixed;
      top: 60px; 
      left: 0;
      bottom: 60px; 
      overflow-y: auto;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5);
      transition: left 0.3s ease;
      z-index: 999;
      border-radius: var(--spotify-border-radius); 
    }

    .sidebar.active {
      left: 0;
    }

    .sidebar h2 {
      margin-top: 0;
      margin-bottom: 15px;
      font-size: 20px;
      color: var(--spotify-light-gray);
    }

    .sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

 

   

  

    .playlist-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .playlist-item-header button {
      background: none;
      color: #e74c3c;
      border: none;
      cursor: pointer;
      font-size: 14px;
      padding: 0;
      margin-left: 10px;
    }

    #create-playlist-input {
      width: calc(100% - 60px);
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #333;
      background-color: #222;
      color: white;
      border-radius: var(--spotify-border-radius);
      box-sizing: border-box;
    }

    #create-playlist-btn {
      background-color: var(--spotify-green);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      transition: background-color 0.3s ease;
      margin-left: 5px;
    }

    #create-playlist-btn:hover {
      background-color: #1ed760;
    }

    /* Main Content */
    .main-content {
      margin-left: 250px; /* Space for sidebar */
      padding: 20px;
      overflow-y: auto;
      flex-grow: 1;
      margin-top: 60px; /* Below the header */
      margin-bottom: 60px; /* Above the footer */
    }

    .main-content h2 {
      color: #ffffff;
      margin-bottom: 15px;
    }

    /* Music Container for Song Cards */
    .music-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      width: 100%;
      max-width: 1200px; /* Adjust as needed */
    }

    .music-card {
      background-color: var(--spotify-card-bg);
      border-radius: var(--spotify-border-radius);
      overflow: hidden;
      transition: all 0.3s ease;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
    }

    .music-card:hover {
      background-color: var(--spotify-hover-bg);
      transform: translateY(-5px);
    }

    .album-art {
      width: 100%;
      padding-top: 100%;
      position: relative;
      overflow: hidden;
    }

    .album-art img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .play-button {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 40px; /* Smaller play button in cards */
      height: 40px;
      background-color: var(--spotify-green);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      cursor: pointer;
    }

    .music-card:hover .play-button {
      opacity: 1;
      transform: translateY(0);
    }

    .play-button i {
      color: var(--spotify-black);
      font-size: 16px; /* Smaller play icon in cards */
      margin-left: 3px;
    }

    .song-info {
      padding: 20px;
    }

    .song-title {
      color: var(--spotify-white);
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .song-artist {
      color: var(--spotify-light-gray);
      font-size: 14px;
      font-weight: 400;
      margin-bottom: 15px;
    }

    /* Progress and Time Info (We'll use the global player's progress) */
    .progress-container, .time-info {
      display: none !important; /* Hide individual card progress */
    }

    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .control-button {
      background: none;
      border: none;
      color: var(--spotify-light-gray);
      font-size: 16px;
      cursor: pointer;
      transition: color 0.2s ease;
      padding: 8px; /* Add some padding to the control buttons */
    }

    .control-button:hover {
      color: var(--spotify-white);
    }

    .main-controls {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .play-pause {
      width: 50px; /* Larger play/pause button */
      height: 50px;
      background-color: var(--spotify-white);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--spotify-black);
      font-size: 20px; /* Larger play/pause icon */
      transition: transform 0.2s ease;
      border: none; /* Remove default button border */
      cursor: pointer;
    }

    .play-pause:hover {
      transform: scale(1.05);
    }

    .volume-control {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .volume-slider {
      width: 80px;
      height: 4px;
      background-color: var(--spotify-dark-gray);
      border-radius: 2px;
      appearance: none;
      outline: none;
    }

    .volume-slider::-webkit-slider-thumb {
      appearance: none;
      width: 12px;
      height: 12px;
      background-color: var(--spotify-white);
      border-radius: 50%;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .volume-control:hover .volume-slider::-webkit-slider-thumb {
      opacity: 1;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .playing .album-art img {
      animation: pulse 2s infinite ease-in-out;
    }

    .playing .play-button {
      background-color: var(--spotify-white);
    }

    .playing .play-button i {
      color: var(--spotify-black);
    }

    /* Error Message */
    .error-message {
      color: #e74c3c;
      font-weight: bold;
      text-align: center;
      margin-top: 20px;
    }

    /* Playlist View */
    #playlist-view {
      display: none;
    }

    #playlist-view h2 {
      color: #ffffff;
      margin-bottom: 15px;
    }

    #playlist-songs-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      width: 100%;
      max-width: 1200px; /* Adjust as needed */
    }
    .add-to-playlist {
    position: absolute;
    bottom: 10px;
    right: 10px;
    background: none;
    border: none;
    color: white;
    font-size: 22px;
    cursor: pointer;
  }

  #playlist-section {
    padding: 20px;
    color: white;
  }

  .playlist-back {
    background: none;
    border: none;
    color: white;
    font-size: 18px;
    cursor: pointer;
    margin-bottom: 10px;
  }

  #playlist-container .card {
    margin: 10px 0;
  }

  .playlist-button {
    background: none;
    border: none;
    color: white;
    font-size: 18px;
    cursor: pointer;
    margin: 10px;
  }

  .playlist-button i {
    margin-right: 6px;
  }

    #playlist-view button {
      background-color: #1e1e1e;
      color: var(--spotify-light-gray);
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s ease, color 0.2s ease;
      margin-top: 20px;
      font-size: 14px;
    }

    #playlist-view button:hover {
      background-color: var(--spotify-hover-bg);
      color: var(--spotify-white);
    }


    #notification {
      position: fixed;
      top: 10px;
      right: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      z-index: 1001;
      display: none;
    }

  
    #song-list ol {
      list-style-type: decimal;
      padding-left: 20px;
    }

    #song-list ol li {
      color: var(--spotify-light-gray);
      cursor: pointer;
      margin-bottom: 10px;
      font-size: 16px;
      transition: color 0.3s ease;
    }

    #song-list ol li:hover {
      color: var(--spotify-white);
    }

    #song-list ol li span.song-artist-list {
      display: block;
      font-size: 14px;
      color: var(--spotify-dark-gray);
      margin-top: 5px;
    }
    #now-playing-view {
      display: none;
      text-align: center;
    }

    .now-playing-container {
      max-width: 400px;
      margin: 20px auto;
      padding: 20px;
      background-color: var(--spotify-card-bg);
      border-radius: var(--spotify-border-radius);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    }

    .now-playing-container .album-art {
      width: 250px;
      height: 250px;
      margin: 0 auto 20px;
      border-radius: 5px;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    .now-playing-container .album-art img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .now-playing-container .song-details h3 {
      color: var(--spotify-white);
      font-size: 20px;
      margin-bottom: 5px;
    }

    .now-playing-container .song-details p {
      color: var(--spotify-light-gray);
      font-size: 16px;
      margin-bottom: 20px;
    }

    .now-playing-container .progress-bar-container {
      width: 100%;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .now-playing-container .progress-bar-container span {
      color: var(--spotify-light-gray);
      font-size: 12px;
      width: 40px;
      text-align: center;
    }

    .now-playing-container .progress-bar {
      flex-grow: 1;
      height: 4px;
      background-color: var(--spotify-dark-gray);
      border-radius: 2px;
      cursor: pointer;
      display: flex;
      align-items: center;
    }

    .now-playing-container .progress-bar-fill {
      background-color: var(--spotify-green);
      height: 100%;
      border-radius: 2px;
      width: 0%; 
    }

    .now-playing-container .controls {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 20px;
    }

    .now-playing-container .controls button {
      background: none;
      border: none;
      color: var(--spotify-white);
      font-size: 24px;
      cursor: pointer;
      transition: color 0.2s ease;
    }

    .now-playing-container .controls button:hover {
      color: var(--spotify-green);
    }

    #now-playing-view button {
      background-color: #1e1e1e;
      color: var(--spotify-light-gray);
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.2s ease, color 0.2s ease;
      margin-top: 20px;
      font-size: 14px;
    }

    #now-playing-view button:hover {
      background-color: var(--spotify-hover-bg);
      color: var(--spotify-white);
    }

    @media (max-width: 767px) {
      .header {
        padding: 10px 15px;
      }
      .logo {
        font-size: 20px;
      }
      .menu {
        display: none; 
      }
      .hamburger-menu {
        display: block;
      }
      .sidebar {
        left: -250px; 
        top: 50px; 
        bottom: 50px; 
      }
      .sidebar.active {
        left: 0;
      }
      .main-content {
        margin-left: 0;
        padding-top: 70px; 
        padding-bottom: 70px; 
      }
      .music-container {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
      .now-playing-container {
        max-width: 90%;
      }
      .now-playing-container .album-art {
        width: 200px;
        height: 200px;
      }
      .now-playing-container .controls {
        gap: 20px;
      }
      .now-playing-container .controls button {
        font-size: 20px;
      }
      #song-list ol {
        padding-left: 15px;
      }
      #song-list ol li {
        font-size: 14px;
        margin-bottom: 8px;
      }
      #song-list ol li span.song-artist-list {
        font-size: 12px;
        margin-top: 3px;
      }
      .now-playing-container .progress-bar-container span {
        font-size: 10px;
        width: 30px;
      }
      .now-playing-container .controls button {
        font-size: 20px;
      }
    }

    @media (min-width: 768px) and (max-width: 991px) {
      .main-content {
        padding-top: 70px; 
        padding-bottom: 70px; 
      }
      .music-container {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }
    }

    .footer {
  position: fixed;
  bottom: 0;
  width: 100%;
  background-color: #121212;
  padding: 10px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 20px;
  box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.3);
  z-index: 1000;
}

.playlist-button {
  background-color: #1db954;
  color: white;
  border: none;
  padding: 10px 16px;
  font-size: 16px;
  border-radius: 25px;
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.playlist-button:hover {
  background-color: #1ed760;
}

#audio-player {
  flex: 1;
  max-width: 400px;
}


    #audio-player {
      width: 90%;
      max-width: 600px;
    }
    @media (max-width: 768px) {
  .sidebar {
    left: -250px;
  }

  .sidebar.active {
    left: 0;
  }

  .main-content {
    margin-left: 0;
  }

  .hamburger-menu {
    display: block;
  }
}
.main-content {
  margin-bottom: 100px; 
}
.main-content {
  margin-bottom: clamp(80px, 10vh, 120px);
}


  </style>
</head>
<body>
  <div id="notification"></div>

  <header class="header">
    <div class="logo">VS Music</div>
    <ul class="menu">
      <li onclick="showSection('all-songs')" data-section="all-songs" class="active">All Songs</li>
      <li onclick="showSection('playlists-section')" data-section="playlists-section">Playlists</li>
      <li onclick="showSection('favorites-section')" data-section="favorites-section">Favorites</li>
    </ul>
    <div class="hamburger-menu" onclick="toggleSidebar()">&#9776;</div>
  </header>

  
  <div class="main-content" data-aos="fade-up">
    <section id="all-songs">
      <h2>All Songs</h2>
      <p>Click on a song to play!</p>
      <div id="song-list">
        </div>
      <div class="error-message" id="error-message" style="display: none;">
        Failed to load songs. Please try again later.
      </div>
    </section>

    <section id="playlist-view" style="display: none;">
      <h2></h2> <div class="music-container" id="playlist-songs-container">
        </div>
      <button onclick="showSection('playlists-section')"><i class="fas fa-arrow-left"></i> Back to Playlists</button>
    </section>

    <section id="favorites-section" style="display: none;">
      <h2>Favorites</h2>
      <div class="music-container" id="favorite-songs-container">
        </div>
    </section>

    <section id="now-playing-view" style="display: none;">
      <h2>Now Playing</h2>
      <div class="now-playing-container">
        <div class="album-art">
          <img id="now-playing-image" src="" alt="Album Art">
        </div>
        <div class="song-details">
          <h3 id="now-playing-title"></h3>
          <p id="now-playing-artist"></p>
        </div>

        <div class="progress-bar-container">
          <span id="current-time">0:00</span>
          <div class="progress-bar" onclick="seekAudio(event)">
            <div class="progress-bar-fill" id="progress-bar-fill"></div>
          </div>
          <span id="duration">0:00</span>
        </div>

        <div class="controls">
          <button class="control-button" onclick="playPrevious()"><i class="fas fa-backward"></i></button>
          <button id="play-pause-button" class="play-pause" onclick="togglePlayPause()"><i class="fas fa-play"></i></button>
          <button class="control-button" onclick="playNext()"><i class="fas fa-forward"></i></button>
        </div>
        <button onclick="showSection('all-songs')" style="background-color: transparent; color: var(--spotify-light-gray); border: 1px solid var(--spotify-light-gray); border-radius: 20px; padding: 8px 15px; margin-top: 20px;"><i class="fas fa-arrow-left"></i> Back</button>
      </div>
    </section>
  </div>
  
 
      
  <div class="music-card" data-aos="fade-up">

    <div class="footer">
      <button id="view-playlist" class="playlist-button">
        <i class='bx bx-list-ul'></i> Playlist
      </button>
      <audio id="audio-player" controls>
        <source id="audio-source" src="" type="audio/mp3">
        Your browser does not support the audio element.
      </audio>
    </div>
    
  

  <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
  <script>
    AOS.init();

    const songListContainer = document.getElementById('song-list');
    const audioPlayer = document.getElementById('audio-player');
    const audioSource = document.getElementById('audio-source');
    const errorMessage = document.getElementById('error-message');
    const sidebar = document.getElementById('sidebar');
    const playlistListSidebar = document.getElementById('playlist-list');
    const favoriteListSidebar = document.getElementById('favorite-list');
    const createPlaylistInput = document.getElementById('create-playlist-input');
    const playlistView = document.getElementById('playlist-view');
    const playlistSongsContainer = document.getElementById('playlist-songs-container');
    const favoriteSongsContainer = document.getElementById('favorite-songs-container');
    const menuItems = document.querySelectorAll('.menu li');
    const notificationDiv = document.getElementById('notification');
    const nowPlayingView = document.getElementById('now-playing-view');
    const nowPlayingImage = document.getElementById('now-playing-image');
    const nowPlayingTitle = document.getElementById('now-playing-title');
    const nowPlayingArtist = document.getElementById('now-playing-artist');
    const playPauseButton = document.getElementById('play-pause-button');
    const progressBar = document.querySelector('.progress-bar');
    const progressBarFill = document.getElementById('progress-bar-fill');
    const currentTimeDisplay = document.getElementById('current-time');
    const durationDisplay = document.getElementById('duration');
    let isPlaying = false; 

    let allSongs = [];
    let playlists = JSON.parse(localStorage.getItem('playlists')) || [];
    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    let currentPlaylistIndex = -1;
    let currentPlayingSongTitle = null;

    function showNotification(message) {
      notificationDiv.textContent = message;
      notificationDiv.style.display = 'block';
      setTimeout(() => {
        notificationDiv.style.display = 'none';
      }, 2000);
    }

    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      const remainingSeconds = Math.floor(seconds % 60).toString().padStart(2, '0');
      return ${minutes}:${remainingSeconds};
    }

    function updateProgress() {
      const { currentTime, duration } = audioPlayer;
      if (duration) {
        const progressPercent = (currentTime / duration) * 100;
        progressBarFill.style.width = ${progressPercent}%;
        currentTimeDisplay.textContent = formatTime(currentTime);
        durationDisplay.textContent = formatTime(duration);
      }
    }

    function seekAudio(event) {
      const progressBarWidth = progressBar.offsetWidth;
      const clickPosition = event.offsetX;
      const seekTime = (clickPosition / progressBarWidth) * audioPlayer.duration;
      audioPlayer.currentTime = seekTime;
    }
    audioPlayer.addEventListener('timeupdate', updateProgress);

    audioPlayer.addEventListener('loadedmetadata', () => {
      durationDisplay.textContent = formatTime(audioPlayer.duration);
    });

    async function fetchSongs() {
      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbziNbRPpADPL1W3AaVxKagzZx1Dsz3pZXPSMgLKMDeF7H9d88x8D-QPVOFpR0wGS_lm8w/exec');
        const data = await response.json();

        if (data && Array.isArray(data)) {
          allSongs = data;
          renderInitialSongList(allSongs); // Render initial simple list
          renderFavoritesListSidebar();
          renderPlaylistsSidebar();
          renderFavoritesListMain();
        } else {
          throw new Error('Invalid data format');
        }
      } catch (error) {
        console.error('Error fetching songs:', error);
        errorMessage.style.display = 'block';
      }
    }

    // Function to render the initial simple list of song titles and artists
    function renderInitialSongList(songs) {
      songListContainer.innerHTML = '';
      const songListOl = document.createElement('ol');
      songs.forEach((song, index) => {
        const songLi = document.createElement('li');
        songLi.innerHTML = <span class="song-title-list">${song.title}</span><br><span class="song-artist-list">${song.artist}</span>;
        songLi.onclick = () => showNowPlaying(song);
        songListOl.appendChild(songLi);
      });
      songListContainer.appendChild(songListOl);
    }

    // Function to show the "Now Playing" view
    function showNowPlaying(song) {
      nowPlayingImage.src = song.image_url;
      nowPlayingTitle.textContent = song.title;
      nowPlayingArtist.textContent = song.artist;
      playSong(song.url, song.title); // Start playing the selected song

      document.getElementById('all-songs').style.display = 'none';
      document.getElementById('favorites-section').style.display = 'none';
      playlistView.style.display = 'none';
      nowPlayingView.style.display = 'block';
    }

    // Function to play song
    function playSong(url, title) {
      audioSource.src = url;
      audioPlayer.load();
      audioPlayer.play();
      isPlaying = true;
      updatePlayPauseButton();
      console.log(Playing: ${title});
      currentPlayingSongTitle = title;
    }

    function togglePlayPause() {
      if (isPlaying) {
        audioPlayer.pause();
        isPlaying = false;
      } else {
        audioPlayer.play();
        isPlaying = true;
      }
      updatePlayPauseButton();
    }
    document.querySelector('.hamburger-menu').addEventListener('click', () => {
  document.querySelector('.sidebar').classList.toggle('active');
});


    function updatePlayPauseButton() {
      if (isPlaying) {
        playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
      } else {
        playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
      }
    }

    function playPrevious() {
      // Implement logic to play previous song if needed
      console.log("Play Previous");
    }

    function playNext() {
      // Implement logic to play next song if needed
      console.log("Play Next");
    }

    // Function to render song list as music cards
    function renderSongCards(songs, container = songListContainer) {
      container.innerHTML = '';
      songs.forEach(song => {
        const isFavorite = favorites.includes(song.title);
        const musicCard = document.createElement('div');
        musicCard.classList.add('music-card');

        musicCard.innerHTML = `
          <div class="album-art">
            <img src="${song.image_url}" alt="${song.title}">
            <div class="play-button" onclick="playSong('${song.url}', '${song.title}')">
              <i class="fas fa-play"></i>
            </div>
          </div>
          <div class="song-info">
            <h3 class="song-title">${song.title}</h3>
            <p class="song-artist">${song.artist}</p>
            <div class="controls">
              <div class="left-controls">
                <button class="control-button" onclick="toggleFavorite('${song.title}')">
                  <i class="fas fa-heart ${isFavorite ? 'fas' : 'far'}"></i>
                </button>
              </div>
              <div class="main-controls">
                </div>
              <div class="volume-control">
                <button class="control-button" onclick="addToPlaylist('${song.title}')">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
            </div>
          </div>
        `;
        container.appendChild(musicCard);

        // Apply 'playing' class if this song is currently playing
        if (song.title === currentPlayingSongTitle) {
          musicCard.classList.add('playing');
        }
      });
    }

    // Function to toggle favorite
    function toggleFavorite(title) {
      if (favorites.includes(title)) {
        favorites = favorites.filter(song => song !== title);
        showNotification(Removed "${title}" from favorites.);
      } else {
        favorites.push(title);
        showNotification(Added "${title}" to favorites.);
      }
      localStorage.setItem('favorites', JSON.stringify(favorites));
      const allMusicCards = document.querySelectorAll('.music-card');
      allMusicCards.forEach(card => {
        const songTitleInCard = card.querySelector('.song-title').textContent;
        const heartIcon = card.querySelector('.fa-heart');
        if (songTitleInCard === title) {
          heartIcon.classList.toggle('fas', favorites.includes(title));
          heartIcon.classList.toggle('far', !favorites.includes(title));
        }
      });
      renderFavoritesListSidebar();
      renderFavoritesListMain();
    }

    // Function to render the favorites list in the sidebar
    function renderFavoritesListSidebar() {
      favoriteListSidebar.innerHTML = '';
      favorites.forEach(title => {
        const li = document.createElement('li');
        li.innerHTML = <i class="fas fa-heart"></i> ${title};
        li.onclick = () => showFavorites();
        favoriteListSidebar.appendChild(li);
      });
    }

    // Function to render the favorites list in the main content as cards
    function renderFavoritesListMain() {
      const favoriteSongs = allSongs.filter(song => favorites.includes(song.title));
      renderSongCards(favoriteSongs, favoriteSongsContainer);
      if (favoriteSongs.length === 0) {
        favoriteSongsContainer.innerHTML = '<p>No favorite songs yet.</p>';
      }
    }
    function togglePlayPause() {
  if (audioPlayer.paused) {
    audioPlayer.play();
    isPlaying = true;
    playPauseButton.innerHTML = '<i class="fas fa-pause"></i>';
  } else {
    audioPlayer.pause();
    isPlaying = false;
    playPauseButton.innerHTML = '<i class="fas fa-play"></i>';
  }
}
let currentSongIndex = 0;

function playPrevious() {
  if (currentSongIndex > 0) {
    currentSongIndex--;
    const prevSong = getCurrentSongList()[currentSongIndex];
    showNowPlaying(prevSong);
  } else {
    showNotification("This is the first song in the list");
  }
}

function playNext() {
  const songs = getCurrentSongList();
  if (currentSongIndex < songs.length - 1) {
    currentSongIndex++;
    const nextSong = songs[currentSongIndex];
    showNowPlaying(nextSong);
  } else {
    showNotification("This is the last song in the list");
  }
}

function getCurrentSongList() {
  if (nowPlayingView.style.display === 'block') {
    return allSongs;
  } else if (playlistView.style.display === 'block') {
    return allSongs.filter(song => playlists[currentPlaylistIndex].songs.includes(song.title));
  } else if (document.getElementById('favorites-section').style.display === 'block') {
    return allSongs.filter(song => favorites.includes(song.title));
  }
  return allSongs;
}
// Update the showNowPlaying function to set currentSongIndex
function showNowPlaying(song) {
  const songs = getCurrentSongList();
  currentSongIndex = songs.findIndex(s => s.title === song.title);
  
  nowPlayingImage.src = song.image_url;
  nowPlayingTitle.textContent = song.title;
  nowPlayingArtist.textContent = song.artist;
  playSong(song.url, song.title);

  document.getElementById('all-songs').style.display = 'none';
  document.getElementById('favorites-section').style.display = 'none';
  playlistView.style.display = 'none';
  nowPlayingView.style.display = 'block';
}

// Update the back button in now-playing-view
document.querySelector('#now-playing-view button').onclick = function() {
  // Determine which section to go back to
  if (playlistView.style.display === 'none') {
    showSection('all-songs');
  } else {
    showPlaylistView(currentPlaylistIndex);
  }
};
// Update the playlist back button
document.querySelector('#playlist-view button').onclick = function() {
  showSection('playlists-section');
};

    // Function to create a new playlist
    function createPlaylist() {
      const playlistName = createPlaylistInput.value.trim();
      if (playlistName) {
        playlists.push({ name: playlistName, songs: [] });
        localStorage.setItem('playlists', JSON.stringify(playlists));
        createPlaylistInput.value = '';
        renderPlaylistsSidebar();
        showNotification(Playlist "${playlistName}" created.);
      }
    }

    // Function to render the playlists in the sidebar with numbered songs
    function renderPlaylistsSidebar() {
      playlistListSidebar.innerHTML = '';
      playlists.forEach((playlist, index) => {
        const playlistLi = document.createElement('li');
        playlistLi.innerHTML = `<i class="fas fa-music"></i> <span onclick="showPlaylistView(${index})">${playlist.name}</span>
                                 <div class="playlist-item-header">
                                   <button onclick="deletePlaylist(${index}); event.stopPropagation();"><i class="fas fa-trash"></i></button>
                                 </div>`;

        const songListOl = document.createElement('ol');
        playlist.songs.forEach((songTitle, songIndex) => {
          const songLi = document.createElement('li');
          songLi.textContent = songTitle;
          songLi.onclick = (event) => {
            event.stopPropagation(); // Prevent the playlist click event from firing
            showPlaylistView(index);
          };
          songListOl.appendChild(songLi);
        });
        playlistLi.appendChild(songListOl);
        playlistListSidebar.appendChild(playlistLi);
      });
    }

    // Function to delete a playlist
    function deletePlaylist(index) {
      const playlistToDelete = playlists[index].name;
      if (confirm(Are you sure you want to delete "${playlistToDelete}"?)) {
        playlists.splice(index, 1);
        localStorage.setItem('playlists', JSON.stringify(playlists));
        renderPlaylistsSidebar();
        if (currentPlaylistIndex === index) {
          showSection('playlists-section');
        }
        showNotification(Playlist "${playlistToDelete}" deleted.);
      }
    }

    // Function to add a song to a playlist
    function addToPlaylist(songTitle) {
      const playlistName = prompt(Enter playlist name to add "${songTitle}" to:);
      if (playlistName) {
        const playlistIndex = playlists.findIndex(p => p.name === playlistName);
        if (playlistIndex !== -1) {
          if (!playlists[playlistIndex].songs.includes(songTitle)) {
            playlists[playlistIndex].songs.push(songTitle);
            localStorage.setItem('playlists', JSON.stringify(playlists));
            renderPlaylistsSidebar(); // Re-render sidebar to show updated list
            showNotification("${songTitle}" added to "${playlistName}");
          } else {
            showNotification("${songTitle}" is already in "${playlistName}");
          }
        } else {
          showNotification(Playlist "${playlistName}" not found.);
        }
      }
    }

    // Function to show the view for a specific playlist
    function showPlaylistView(index) {
      currentPlaylistIndex = index;
      const playlist = playlists[index];
      playlistView.querySelector('h2').textContent = playlist.name;
      const playlistSongs = allSongs.filter(song => playlist.songs.includes(song.title));
      renderSongCards(playlistSongs, playlistSongsContainer);

      // Update the buttons on the playlist song cards
      playlistSongsContainer.querySelectorAll('.music-card').forEach(card => {
        const title = card.querySelector('.song-title').textContent;
        const controlsDiv = card.querySelector('.controls');
        controlsDiv.innerHTML = `
          <div class="left-controls">
            <button class="control-button" onclick="toggleFavorite('${title}')">
              <i class="fas fa-heart ${favorites.includes(title) ? 'fas' : 'far'}"></i>
            </button>
          </div>
          <div class="main-controls">
            </div>
          <div class="volume-control">
            <button class="control-button" onclick="removeSongFromPlaylist('${index}', '${title}')">
              <i class="fas fa-trash"></i> Remove
            </button>
          </div>
        `;
      });

      document.getElementById('all-songs').style.display = 'none';
      document.getElementById('favorites-section').style.display = 'none';
      nowPlayingView.style.display = 'none';
      playlistView.style.display = 'block';
      setActiveMenuItem('playlists-section');
    }

    // Function to remove a song from a playlist
    function removeSongFromPlaylist(playlistIndex, songTitle) {
      playlists[playlistIndex].songs = playlists[playlistIndex].songs.filter(title => title !== songTitle);
      localStorage.setItem('playlists', JSON.stringify(playlists));
      renderPlaylistsSidebar(); // Re-render sidebar to update the list
      showPlaylistView(playlistIndex); // Re-render the playlist view
      showNotification(Removed "${songTitle}" from "${playlists[playlistIndex].name}");
    }

    // Function to show the favorites section in the main content
    function showFavorites() {
      document.getElementById('all-songs').style.display = 'none';
      playlistView.style.display = 'none';
      nowPlayingView.style.display = 'none';
      document.getElementById('favorites-section').style.display = 'block';
      renderSongCards(allSongs.filter(song => favorites.includes(song.title)), favoriteSongsContainer);
      setActiveMenuItem('favorites-section');
    }

    // Toggle Sidebar Visibility
    function toggleSidebar() {
      sidebar.classList.toggle('active');
    }

    // Function to show/hide sections and update menu active state
    function showSection(sectionId) {
      document.getElementById('all-songs').style.display = sectionId === 'all-songs' ? 'block' : 'none';
      document.getElementById('favorites-section').style.display = sectionId === 'favorites-section' ? 'block' : 'none';
      playlistView.style.display = 'none';
      nowPlayingView.style.display = 'none';

      setActiveMenuItem(sectionId);

      if (window.innerWidth <= 767) {
        toggleSidebar(); // Hide sidebar after navigation on mobile
      }
      if (sectionId === 'all-songs') {
        renderInitialSongList(allSongs);
        songListContainer.classList.remove('music-container'); // Ensure it's not using card layout
      } else if (sectionId === 'favorites-section') {
        renderSongCards(allSongs.filter(song => favorites.includes(song.title)), favoriteSongsContainer);
      } else if (sectionId === 'playlists-section') {
        renderPlaylistsSidebar();
      }
    }

    function setActiveMenuItem(sectionId) {
      menuItems.forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('data-section') === sectionId) {
          item.classList.add('active');
        }
      });
    }

    // Load data on page load
    document.addEventListener('DOMContentLoaded', () => {
      fetchSongs();
      showSection('all-songs'); // Show all songs by default
    });
    function renderInitialSongList(songs) {
  songListContainer.innerHTML = '';
  const songListOl = document.createElement('ol');
  songs.forEach((song, index) => {
    const songLi = document.createElement('li');
    const isFavorite = favorites.includes(song.title);
    songLi.innerHTML = `
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <span class="song-title-list">${song.title}</span><br>
          <span class="song-artist-list">${song.artist}</span>
        </div>
        <button class="control-button favorite-btn" onclick="toggleFavorite('${song.title}', this); event.stopPropagation()">
          <i class="fas fa-heart ${isFavorite ? 'fas' : 'far'}"></i>
        </button>
      </div>
    `;
    songLi.onclick = () => showNowPlaying(song);
    songListOl.appendChild(songLi);
  });
  songListContainer.appendChild(songListOl);
}
function toggleFavorite(title, buttonElement = null) {
  if (favorites.includes(title)) {
    favorites = favorites.filter(song => song !== title);
    showNotification(Removed "${title}" from favorites.);
    if (buttonElement) {
      buttonElement.innerHTML = '<i class="far fa-heart"></i>';
    }
  } else {
    favorites.push(title);
    showNotification(Added "${title}" to favorites.);
    if (buttonElement) {
      buttonElement.innerHTML = '<i class="fas fa-heart"></i>';
    }
  }
  localStorage.setItem('favorites', JSON.stringify(favorites));
  
  // Update all instances of this song's favorite button
  document.querySelectorAll(.music-card .song-title).forEach(titleElement => {
    if (titleElement.textContent === title) {
      const card = titleElement.closest('.music-card');
      const heartIcon = card.querySelector('.favorite-btn i');
      heartIcon.classList.toggle('fas', favorites.includes(title));
      heartIcon.classList.toggle('far', !favorites.includes(title));
    }
  });
  
  renderFavoritesListSidebar();
  renderFavoritesListMain();
}
function renderSongCards(songs, container = songListContainer) {
  container.innerHTML = '';
  songs.forEach(song => {
    const isFavorite = favorites.includes(song.title);
    const musicCard = document.createElement('div');
    musicCard.classList.add('music-card');

    musicCard.innerHTML = `
      <div class="album-art">
        <img src="${song.image_url}" alt="${song.title}">
        <div class="play-button" onclick="playSong('${song.url}', '${song.title}')">
          <i class="fas fa-play"></i>
        </div>
      </div>
      <div class="song-info">
        <h3 class="song-title">${song.title}</h3>
        <p class="song-artist">${song.artist}</p>
        <div class="controls">
          <button class="control-button favorite-btn" onclick="toggleFavorite('${song.title}', this)">
            <i class="fas fa-heart ${isFavorite ? 'fas' : 'far'}"></i>
          </button>
          <button class="control-button" onclick="addToPlaylist('${song.title}')">
            <i class="fas fa-plus"></i>
          </button>
        </div>
      </div>
    `;
    container.appendChild(musicCard);

    // Apply 'playing' class if this song is currently playing
    if (song.title === currentPlayingSongTitle) {
      musicCard.classList.add('playing');
    }
  });
}
const playlist = [];
  const playlistSection = document.getElementById('playlist-section');
  const playlistContainer = document.getElementById('playlist-container');
  const homeSection = document.querySelector('.cards-container');
  const addToPlaylistButtons = document.querySelectorAll('.add-to-playlist');

  // Add to playlist
  addToPlaylistButtons.forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      const card = btn.closest('.card');
      const title = card.dataset.title;
      const artist = card.dataset.artist;
      const image = card.dataset.image;

      if (!playlist.find(song => song.title === title && song.artist === artist)) {
        playlist.push({ title, artist, image });
        alert(${title} added to playlist);
      }
    });
  });

  // Show playlist
  document.getElementById('view-playlist').addEventListener('click', () => {
    homeSection.style.display = 'none';
    playlistSection.style.display = 'block';
    renderPlaylist();
  });

  // Back to home
  document.getElementById('back-to-home').addEventListener('click', () => {
    playlistSection.style.display = 'none';
    homeSection.style.display = 'flex';
  });

  function renderPlaylist() {
    playlistContainer.innerHTML = '';
    if (playlist.length === 0) {
      playlistContainer.innerHTML = '<p>No songs in playlist.</p>';
      return;
    }

    playlist.forEach(song => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${song.image}" alt="${song.title}">
        <h3>${song.title}</h3>
        <p>${song.artist}</p>
      `;
      playlistContainer.appendChild(card);
    });
  }
  </script>
</body>
</html>
