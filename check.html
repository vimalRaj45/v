<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Links</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.16.24/dist/css/uikit.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.16.24/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.16.24/dist/js/uikit-icons.min.js"></script>
</head>
<body class="uk-container uk-margin-large-top">

    <h2 class="uk-text-center uk-text-primary">Upload Links</h2>

    <form id="uploadForm" class="uk-form-stacked uk-card uk-card-default uk-card-body uk-width-1-2@m uk-margin-auto">
        <div class="uk-margin">
            <label class="uk-form-label">Email:</label>
            <input class="uk-input" type="email" id="email" required>
        </div>

        <div class="uk-margin">
            <label class="uk-form-label">File Name:</label>
            <input class="uk-input" type="text" id="fileName" required>
        </div>

        <div class="uk-margin">
            <label class="uk-form-label">Enter Link:</label>
            <input class="uk-input" type="url" id="fileLink" required>
        </div>

        <button type="submit" class="uk-button uk-button-primary uk-width-1-1">Submit</button>
    </form>

    <p id="status" class="uk-text-center uk-margin-top"></p>

    <div class="uk-container uk-margin-top">
        <h3 class="uk-text-center">Uploaded Links</h3>
        <div id="dataDisplay" class="uk-overflow-auto"></div>
    </div>

    <script>
        document.getElementById("uploadForm").addEventListener("submit", async function(event) {
            event.preventDefault();
            
            const email = document.getElementById("email").value;
            const fileName = document.getElementById("fileName").value;
            const fileLink = document.getElementById("fileLink").value;

            let formData = new FormData();
            formData.append("email", email);
            formData.append("fileName", fileName);
            formData.append("fileLink", fileLink);

            document.getElementById("status").innerHTML = '<span class="uk-label uk-label-warning">Uploading...</span>';

            try {
                let response = await fetch("https://script.google.com/macros/s/AKfycbygZYlZjUX-5_Tfxbb1RRTQKuwGHMrl9zbuG4QdUoVJKw73Pqx9gWdLHXCp2gz4CA2Q/exec", {
                    method: "POST",
                    body: formData
                });

                let result = await response.json();
                document.getElementById("status").innerHTML = `<span class="uk-label uk-label-success">${result.message}</span>`;
                fetchData(); // Refresh table after submission
            } catch (error) {
                document.getElementById("status").innerHTML = '<span class="uk-label uk-label-danger">Error uploading link.</span>';
            }
        });

        async function fetchData() {
            let response = await fetch("https://script.google.com/macros/s/AKfycbygZYlZjUX-5_Tfxbb1RRTQKuwGHMrl9zbuG4QdUoVJKw73Pqx9gWdLHXCp2gz4CA2Q/exec");
            let data = await response.json();

            let table = `<table class="uk-table uk-table-striped uk-table-hover">
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>File Name</th>
                                    <th>File URL</th>
                                </tr>
                            </thead>
                            <tbody>`;

            data.slice(1).forEach(row => {
                table += `<tr>
                            <td>${row[0]}</td>
                            <td>${row[1]}</td>
                            <td><a href="${row[2]}" target="_blank" class="uk-button uk-button-text">View</a></td>
                        </tr>`;
            });

            table += "</tbody></table>";
            document.getElementById("dataDisplay").innerHTML = table;
        }

        fetchData();
    </script>

</body>
</html>
