<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Navigation (GraphHopper + Google Maps Routing)</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        button { padding: 10px; margin: 10px; cursor: pointer; }
    </style>
</head>
<body>
    <h2>Campus Navigation</h2>
    <button onclick="getLocation()">Get My Location</button>
    <button onclick="routeToLibrary()">Route to Library</button>
    <p id="status"></p>
    <p id="address">Address: -</p>

    <script>
        let apiKey = "908f81b3-d677-438e-a4f0-aac03af858aa"; // Replace with your GraphHopper API Key
        let userCoords;

        function getLocation() {
            document.getElementById("status").innerText = "Please wait... Getting your location.";
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                alert("Geolocation is not supported by this browser.");
                document.getElementById("status").innerText = "";
            }
        }

        function showPosition(position) {
            let lat = position.coords.latitude;
            let lon = position.coords.longitude;
            userCoords = { lat: lat, lng: lon };

            getAddress(lat, lon);
        }

        function getAddress(lat, lon) {
            let url = `https://graphhopper.com/api/1/geocode?reverse=true&point=${lat},${lon}&key=${apiKey}`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    let address = data.hits.length > 0 ? data.hits[0].name : "Address not found";
                    document.getElementById("address").innerText = `Address: ${address}`;
                    document.getElementById("status").innerText = "Location found!";
                })
                .catch(error => {
                    console.error("Error fetching address:", error);
                    document.getElementById("status").innerText = "Failed to get address.";
                });
        }

        function routeToLibrary() {
            if (!userCoords) {
                alert("First, get your location!");
                return;
            }

            document.getElementById("status").innerText = "Please wait... Fetching route.";
            
            let libraryCoords = "11.677865,78.126028"; // Replace with actual library coordinates
            let googleMapsURL = `https://www.google.com/maps/dir/?api=1&origin=${userCoords.lat},${userCoords.lng}&destination=${libraryCoords}&travelmode=driving&maptype=satellite`;

            setTimeout(() => {
                document.getElementById("status").innerText = "";
                window.open(googleMapsURL, "_blank");
            }, 2000); // Simulates a short delay before opening the route
        }

        function showError(error) {
            let msg;
            switch(error.code) {
                case error.PERMISSION_DENIED: msg = "User denied the request for Geolocation."; break;
                case error.POSITION_UNAVAILABLE: msg = "Location information is unavailable."; break;
                case error.TIMEOUT: msg = "The request to get user location timed out."; break;
                case error.UNKNOWN_ERROR: msg = "An unknown error occurred."; break;
            }
            document.getElementById("status").innerText = msg;
            alert(msg);
        }
    </script>
</body>
</html>
